{% extends 'base/base.html' %}
{% load static %}

{% block title %}语法 - 我的网站{% endblock %}

{% block content %}
<div class="page-syntax">
  <aside class="sidebar">
    <h2 class="sidebar-title">Python语法目录</h2>
    <ul class="sidebar-menu">
      <li class="menu-item">
        <a href="#variable" class="active">变量与赋值</a>
      </li>
      <li class="menu-item">
        <a href="#datatype">数据类型</a>
      </li>
      <li class="menu-item">
        <a href="#operator">运算符</a>
      </li>
      <li class="menu-item">
        <a href="#condition">条件判断</a>
      </li>
      <li class="menu-item">
        <a href="#loop">循环语句</a>
      </li>
      <li class="menu-item">
        <a href="#function">函数定义</a>
      </li>
      <li class="menu-item">
        <a href="#class">类与对象</a>
      </li>
      <li class="menu-item">
        <a href="#module">模块与导入</a>
      </li>
    </ul>
  </aside>
  
  <main class="main-content">
    <!-- 内容区域 -->
  </main>
</div>

<script>
  // 导航栏高亮跟随滚动
  (function() {
    'use strict';
    
    const sections = document.querySelectorAll('.main-content h1, .main-content h2');
    const navLinks = document.querySelectorAll('.sidebar-menu a');
    
    if (sections.length === 0 || navLinks.length === 0) return;
    
    function updateActiveLink() {
      let current = '';
      const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
      
      sections.forEach(sec => {
        const sectionTop = sec.offsetTop - 150;
        if (scrollPosition >= sectionTop) {
          current = sec.getAttribute('id') || sec.getAttribute('name');
        }
      });
      
      navLinks.forEach(a => {
        a.closest('.menu-item')?.classList.remove('active');
        const href = a.getAttribute('href');
        if (href && (href === '#' + current || href.includes(current))) {
          a.closest('.menu-item')?.classList.add('active');
        }
      });
    }
    
    // 点击菜单项平滑滚动
    navLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        const href = this.getAttribute('href');
        if (href && href.startsWith('#')) {
          e.preventDefault();
          const targetId = href.substring(1);
          const targetElement = document.getElementById(targetId) || document.querySelector(`[name="${targetId}"]`);
          
          if (targetElement) {
            const offsetTop = targetElement.offsetTop - 120;
            window.scrollTo({
              top: offsetTop,
              behavior: 'smooth'
            });
            
            // 更新active状态
            navLinks.forEach(l => l.closest('.menu-item')?.classList.remove('active'));
            this.closest('.menu-item')?.classList.add('active');
          }
        }
      });
    });
    
    // 监听滚动事件
    let ticking = false;
    window.addEventListener('scroll', function() {
      if (!ticking) {
        window.requestAnimationFrame(function() {
          updateActiveLink();
          ticking = false;
        });
        ticking = true;
      }
    }, { passive: true });
    
    // 页面加载时初始化
    updateActiveLink();
  })();
</script>
{% endblock %}
